<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horarios</title>

    <style>
        :root{
            --color-yellow: #FCB814;
            --color-black: #221F20;
        }

        body{
            width: 100%;
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }

        header{
            width: 100%;
            height: 8%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            background-color: var(--color-black);
            padding: 0;
            margin: 0;
        }

        header a{
            width: 3rem;
            height: 3rem;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 3rem 0 3rem;
            margin: 0;
        }

        header a img{
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        main{
            width: 100%;
            height: 92%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            background-color: var(--color-yellow);
            padding: 0;
            margin: 0;
        }
    </style>

</head>
<body>

    <header>
        <a href=""><img src="./assets/ICON-BRUTO-FI-YELLOW.png" alt="LOGO"></a>
    </header>

    <main>
        <button class="button_accion" id="button_accion">Descargar excel</button>
    </main>
    
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>

        let button_accion = document.getElementById("button_accion")

        const DIAS = ["lunes", "martes", "miercoles", "jueves", "viernes", "sabado"]
        const HORAS = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
        
        // --- CLASE MATERIA ---
        class Materia {
            constructor(nombre_materia, horas_materia, grado_materia, turno_materia, tsu_materia) {
                this.nombre_materia = nombre_materia;
                this.horas_materia = horas_materia;
                this.grado_materia = grado_materia;
                this.turno_materia = turno_materia;
                this.tsu_materia = tsu_materia;
                this.docente = null; // Inicializa la referencia al docente

                this.desglose_horas = {
                    horas_clase_1: 0,
                    horas_clase_2: 0,
                    horas_clase_3: 0,
                    horas_clase_4: 0,
                    horas_clase_5: 0
                }
            }

            determinar_horas_clase_por_materia(){
                const tipo = this.docente.tipo_docente;
                const horas = this.horas_materia;
                // Referencia corta para no escribir tanto
                const d = this.desglose_horas; 

                // Particion para Ingles (Tipo 1) esto se determina por el tipo de docnete
                if (tipo === 1) {
                    if (horas == 5) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; }
                    else if (horas == 7) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 1; }
                    else if (horas == 8) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 2; }
                    else if (horas == 9) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 2; d.horas_clase_5 = 1; }
                    else if (horas == 10) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 2; d.horas_clase_5 = 2; }
                    else if (horas == 15) { d.horas_clase_1 = 3; d.horas_clase_2 = 3; d.horas_clase_3 = 3; d.horas_clase_4 = 3; d.horas_clase_5 = 3; }
                    else if (horas == 20) { d.horas_clase_1 = 4; d.horas_clase_2 = 4; d.horas_clase_3 = 4; d.horas_clase_4 = 4; d.horas_clase_5 = 4; }
                }
                // Particion para PA
                else if (tipo === 2) {
                    if (horas == 1) { d.horas_clase_1 = 1 }
                    else if (horas == 2) { d.horas_clase_1 = 2 }
                    else if (horas == 3) { d.horas_clase_1 = 2; d.horas_clase_2 = 1 }
                    else if (horas == 4) { d.horas_clase_1 = 2; d.horas_clase_2 = 2 }
                    else if (horas == 5) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; }
                    else if (horas == 7) { d.horas_clase_1 = 3; d.horas_clase_2 = 2; d.horas_clase_3 = 2 }
                }
                else if (tipo === 3 || tipo === 4) {
                    if (horas == 1) { d.horas_clase_1 = 1 }
                    else if (horas == 2) { d.horas_clase_1 = 2 }
                    else if (horas == 3) { d.horas_clase_1 = 2; d.horas_clase_2 = 1 }
                    else if (horas == 4) { d.horas_clase_1 = 2; d.horas_clase_2 = 2 }
                    else if (horas == 5) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; }
                    else if (horas == 7) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 1 }
                }

            }

            asignarDocente(docente) {
                if (docente instanceof Docente) {
                    this.docente = docente;
                    docente.agregarMateria(this); 
                    // ¡Llamarlo aquí asegura que las horas se repartan en cuanto llega el docente!
                    this.determinar_horas_clase_por_materia(); 
                }
            }
        }
        
        // Materias 1° cuatrimestre LAGE_NA
        let TUTORIA_1RO = new Materia("TUTORIA 1RO", 2, 1, "MATUTINO", "NA")
        let DESARROLLO_HUMANO_Y_VALORES = new Materia("DESARROLLO HUMANO Y VALORES", 4, 1, "MATUTINO", "NA");
        let FUNDAMENTOS_MATEMATICOS = new Materia("FUNDAMENTOS MATEMATICOS", 7, 1, "MATUTINO", "GCH");
        let FUNDAMENTOS_DE_LA_ADMINISTRACION = new Materia("FUNDAMENTOS DE LA ADMINISTRACION", 4, 1, "MATUTINO", "NA");
        let CONTABILIDAD_I = new Materia("CONTABILIDAD I", 6, 1, "MATUTINO", "NA");
        let MARCO_LEGAL_DE_LAS_ORGANIZACIONES = new Materia("MARCO LEGAL DE LAS ORGANIZACIONES", 4, 1, "MATUTINO", "NA");
        let COMUNICACION_Y_HABILIDADES_DIGITALES = new Materia("COMUNICACION Y HABILIDADES DIGITALES", 5, 1, "MATUTINO", "NA");
        let INGLES_I = new Materia("INGLES I", 15, 1, "MATUTINO", "NA");

        // Materias 4° cuatrimestre (Gestion del capital humano / GCH) 
        let TUTORIA_4TO_GCH = new Materia("TUTORIA 4TO GCH", 2, 4, "VESPERTINO", "GCH")
        let ETICA_PROFESIONAL_GCH = new Materia("ETICA PROFESIONAL", 4, 4, "VESPERTINO", "GCH");
        let GESTION_DEL_CAPITAL_HUMANO = new Materia("GESTION DEL CAPITAL HUMANO", 5, 4, "VESPERTINO", "GCH");
        let INTEGRACIÓN_DEL_CAPITAL_HUMANO = new Materia("INTEGRACION DEL CAPITAL HUMANO", 5, 4, "VESPERTINO", "GCH");
        let COMPORTAMIENTO_ORGANIZACIONAL = new Materia("COMPORTAMIENTO ORGANIZACIONAL", 5, 4, "VESPERTINO", "GCH");
        let SUELDOS_Y_SALARIOS_I = new Materia("SUELDOS Y SALARIOS I", 7, 4, "VESPERTINO", "GCH");
        let LEGISLACION_LABORAL = new Materia("LEGISLACION LABORAL", 4, 4, "VESPERTINO", "GCH");
        let INGLES_IV_GCH = new Materia("INGLES IV", 8, 4, "VESPERTINO", "GCH");

        // Materias 4° cuatrimestre (Emprendimiento y formulacion y evaluacion de proyectos / EFEP)
        let TUTORIA_4TO_EFEP = new Materia("TUTORIA 4TO EFEP", 2, 4, "VESPERTINO", "EFEP")
        let ETICA_PROFESIONAL_EFEP = new Materia("ETICA PROFESIONAL", 4, 4, "VESPERTINO", "EFEP");
        let INNOVACION_Y_EMPRENDIMIENTO = new Materia("INNOVACION Y EMPRENDIMIENTO", 5, 4, "VESPERTINO", "EFEP");
        let ESTUDIO_DE_MERCADO = new Materia("ESTUDIO DE MERCADO", 6, 4, "VESPERTINO", "EFEP");
        let ADMINISTRACIÓN_DE_PROYECTOS_I = new Materia("ESTUDIO DE MERCADO", 5, 4, "VESPERTINO", "EFEP");
        let FUNDAMENTOS_DE_SISTEMAS_DE_PRODUCCIÓN = new Materia("FUNDAMENTOS DE SISTEMAS DE PRODUCCION", 4, 4, "VESPERTINO", "EFEP");
        let ESTUDIO_TÉCNICO_Y_ORGANIZACIONAL = new Materia("ESTUDIO TÉCNICO Y ORGANIZACIONAL", 6, 4, "VESPERTINO", "EFEP");
        let INGLES_IV_EFEP = new Materia("INGLES IV", 8, 4, "VESPERTINO", "EFEP");

        // Materias 7° cuatrimestre LAGE_NA
        let TUTORIA_7MO = new Materia("TUTORIA 7MO", 2, 7, "VESPERTINO", "NA")
        let COMERCIO_INTERNACIONAL = new Materia("COMERCIO INTERNACIONAL", 5, 7, "VESPERTINO", "NA")
        let SUSTENTABILIDAD = new Materia("SUSTENTABILIDAD", 5, 7, "VESPERTINO", "NA")
        let CONTRIBUCIONES_FISCALES = new Materia("CONTRIBUCIONES FISCALES", 6, 7, "VESPERTINO", "NA")
        let ADMINISTRACION_DE_LA_PRODUCCION = new Materia("ADMINISTRACION DE LA PRODUCCION", 6, 7, "VESPERTINO", "NA")
        let TECNOLOGIAS_DE_LA_INFORMACION_APLICADA_A_LOS_NEGOCIOS = new Materia("TECNOLOGIAS DE LA INFORMACION APLICADA A LOS NEGOCIOS", 4, 7, "VESPERTINO", "NA")
        let SEMINARIO_DE_LA_INNOVACION = new Materia("SEMINARIO DE LA INNOVACION", 5, 7, "VESPERTINO", "NA")
        let INGLES_VII = new Materia("INGLES VII", 5, 7, "VESPERTINO", "EFEP")

        let lista_materias_LAGE_1ro_A = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_1ro_B = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_1ro_C = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_4to_GCH = [
            TUTORIA_4TO_GCH,
            ETICA_PROFESIONAL_GCH,
            GESTION_DEL_CAPITAL_HUMANO,
            INTEGRACIÓN_DEL_CAPITAL_HUMANO,
            COMPORTAMIENTO_ORGANIZACIONAL,
            SUELDOS_Y_SALARIOS_I,
            LEGISLACION_LABORAL,
            INGLES_IV_GCH
        ]

        let lista_materias_LAGE_4to_EFEP = [
            TUTORIA_4TO_EFEP,
            ETICA_PROFESIONAL_EFEP,
            INNOVACION_Y_EMPRENDIMIENTO,
            ESTUDIO_DE_MERCADO,
            ADMINISTRACIÓN_DE_PROYECTOS_I,
            FUNDAMENTOS_DE_SISTEMAS_DE_PRODUCCIÓN,
            ESTUDIO_TÉCNICO_Y_ORGANIZACIONAL,
            INGLES_IV_EFEP
        ]

        let lista_materias_LAGE_7mo = [
            TUTORIA_7MO,
            COMERCIO_INTERNACIONAL,
            SUSTENTABILIDAD,
            CONTRIBUCIONES_FISCALES,
            ADMINISTRACION_DE_LA_PRODUCCION,
            TECNOLOGIAS_DE_LA_INFORMACION_APLICADA_A_LOS_NEGOCIOS,
            SEMINARIO_DE_LA_INNOVACION,
            INGLES_VII
        ]

        //creamos la clase Grupo
        class Grupo {
            static lista_grupos_LAGE = []


            constructor(nombre_grupo, listaMateriasPlantilla = []) {
                this.nombre_grupo = nombre_grupo
                this.horario_lunes_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.horario_martes_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.horario_miercoles_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.horario_jueves_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.horario_viernes_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.horario_sabado_grupo = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
                this.materias = []

                // Si pasamos una lista al crear el grupo, las clonamos automáticamente
                listaMateriasPlantilla.forEach(materia => {
                    this.agregarMateria(materia)
                })

                Grupo.lista_grupos_LAGE.push(this)
            }

            agregarMateria(materia) {
                if (materia instanceof Materia) {
                    // Creamos un nuevo objeto Materia con los mismos datos 
                    // para que cada grupo tenga su propia instancia única
                    const materiaClonada = new Materia(
                        materia.nombre_materia,
                        materia.horas_materia,
                        materia.grado_materia,
                        materia.turno_materia,
                        materia.tsu_materia
                    )
                    // NUEVO: Vincular la materia clonada con este grupo específico
                     materiaClonada.grupo = this
                    this.materias.push(materiaClonada)
                }
            }

            asignarDocenteAMateria(nombreMateria, docente) {
                // 1. Buscamos la materia específica dentro de este grupo
                const materiaEncontrada = this.materias.find(m => m.nombre_materia === nombreMateria);

                if (materiaEncontrada && docente instanceof Docente) {
                    // 2. Llamamos al método asignarDocente de la CLASE MATERIA
                    materiaEncontrada.asignarDocente(docente);
                }
            }

        }

        //creamos los grupos de LAGE
        let LAGE_1ro_NA_A = new Grupo("LAGE_1ro_NA_A", lista_materias_LAGE_1ro_A)
        let LAGE_1ro_NA_B = new Grupo("LAGE_1ro_NA_B", lista_materias_LAGE_1ro_B)
        let LAGE_1ro_NA_C = new Grupo("LAGE_1ro_NA_C", lista_materias_LAGE_1ro_C)

        let LAGE_4to_GCH_A = new Grupo("LAGE_4to_GCH_A", lista_materias_LAGE_4to_GCH)
        
        let LAGE_4to_EFEP_A = new Grupo("LAGE_4to_EFEP_A", lista_materias_LAGE_4to_EFEP)
        let LAGE_4to_EFEP_B = new Grupo("LAGE_4to_EFEP_B", lista_materias_LAGE_4to_EFEP)

        let LAGE_7mo_NA_A = new Grupo("LAGE_7mo_NA_A", lista_materias_LAGE_7mo)
        let LAGE_7mo_NA_B = new Grupo("LAGE_7mo_NA_B", lista_materias_LAGE_7mo)
        let LAGE_7mo_NA_C = new Grupo("LAGE_7mo_NA_C", lista_materias_LAGE_7mo)




            // --- CLASE DOCENTE
        class Docente {
            static lista_docentes = []
            constructor(nombre_docente, dispoinibilidad_lunes, dispoinibilidad_martes, dispoinibilidad_miercoles, dispoinibilidad_jueves, dispoinibilidad_viernes, dispoinibilidad_sabado, tipo_docente) {
                this.nombre_docente = nombre_docente
                this.dispoinibilidad_lunes = dispoinibilidad_lunes;
                this.horas_lunes = 0;
                this.lista_horas_lunes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_lunes)
                this.dispoinibilidad_martes = dispoinibilidad_martes
                this.horas_martes = 0;
                this.lista_horas_martes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_martes)
                this.dispoinibilidad_miercoles = dispoinibilidad_miercoles
                this.horas_miercoles = 0;
                this.lista_horas_miercoles_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_miercoles)
                this.dispoinibilidad_jueves = dispoinibilidad_jueves
                this.horas_jueves = 0;
                this.lista_horas_jueves_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_jueves)
                this.dispoinibilidad_viernes = dispoinibilidad_viernes
                this.horas_viernes = 0
                this.lista_horas_viernes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_viernes)
                this.dispoinibilidad_sabado = dispoinibilidad_sabado
                this.horas_sabado = 0
                this.lista_horas_sabado_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_sabado)
                this.tipo_docente = tipo_docente //1 = Ingles, 2 = PA, 3 = PTC, 4 = administractivos
                this.horas_carga = 0
                this.horas_disponibilidad = 0
                this.cantidad_dias_disponibles = 0
                this.prioridad = 0
                this.materias_impartidas_docente = []
                Docente.lista_docentes.push(this)
            }
            //Funcion que crea las listas de horarios de los docentes (Con esto ya empezamos a considerar horarios)
            generar_lista_disponibilidad_por_dia_docente(str){
                if (!str || str === "-") return [];
    
                    let horas = [];
                    const grupos = str.split(" ");
                                                        grupos.forEach(grupo => {
                        const [inicio, fin] = grupo.split("-").map(Number);
                        for (let i = inicio; i < fin; i++) {
                            horas.push(i);
                        }
                    })
                    return horas;
            }
                
            agregarMateria(materia) {
                // Verificamos si la instancia exacta ya está. 
                // Como cada materia clonada es un objeto nuevo, esto debería pasar siempre.
                if (!this.materias_impartidas_docente.includes(materia)) {
                    this.materias_impartidas_docente.push(materia);
                    this.horas_carga += materia.horas_materia;
                }
            }
        
        }

        //declaramos los docentes ----
        let Gabriela_Lazcano_Cortes = new Docente("Gabriela Lazcano Cortes", "13-21", "13-21", "13-17", "13-17", "12-15", "-", 3)
        let Mariana_Santillan_Arroyo = new Docente("Mariana Santillan Arroyo", "12-17", "12-17", "13-21", "12-17", "12-17", "-", 3)
        let Horacio_Sanchez_Hernandez = new Docente("Horacio_Sanchez_Hernandez", "10-15", "10-15", "7-11 - 14-15", "7-11 14-15", "14-16", "-", 3)
        let Irma_Elizabeth_Bautista_Valencia = new Docente("Irma_Elizabeth_Bautista_Valencia", "13-21", "13-21", "9-11 13-17", "9-11 13-16", "9-11 13-16", "-", 3)

        let Abner_Hesli_Rojas_Calva = new Docente("Abner Hesli Rojas Calva", "-", "12-14 16-21", "-", "17-21", "12-14", "-", 2)
        let Carolina_Sosa_Alvarez = new Docente("Carolina_Sosa_Alvarez", "13-21", "13-19", "13-17", "13-17", "13-21", "-", 2)
        let Marco_Antonio_Hernandez_Granados = new Docente("Marco Antonio Hernandez Granados", "10-21", "10-21", "14-21", "14-21", "14-21", "-", 2)
        let Karla_Escalante_Alarcon = new Docente("Karla Escalante Alarcon", "7-21", "7-21", "7-21", "7-21", "7-21", "-", 2)
        let Mitzi_Ailed_Rosario_Moreno_Ramirez = new Docente("Mitzi Ailed Rosario Moreno Ramirez", "7-17", "16-21", "13-15", "16-21", "7-17", "-", 2)
        let Arturo_Martinez_Sandoval = new Docente("Arturo Martinez Sandoval", "15-21", "15-21", "15-21", "15-21", "15-21", "-", 2)
        let Juan_Carlos_Rodriguez_Olmedo = new Docente("Juan Carlos Rodriguez Olmedo", "12-21", "12-21", "12-21", "12-21", "12-21", "-", 2)
        let Guillermo_Nicolas_Martinez_Sanchez = new Docente("Guillermo Nicolas Martinez Sanchez", "10-18", "10-18", "7-15", "-", "-", "-", 2)
        let Ivan_De_La_Selva_Hernandez = new Docente("Ivan De La Selva Hernandez", "12-14 16-21", "12-14 15-21", "12-14 16-21", "-", "-", "-", 2)
        let Daniela_Placido_Soriano = new Docente("Daniela Placido Soriano", "10-16", "10-16", "9-11 12-16", "9-11 12-16", "9-11 12-16", "-", 2)
        let Cristian_Arturo_Granados_Herrera = new Docente("Cristian Arturo Granados Herrera", "15-18", "14-19", "13-17", "14-19", "-", "-", 2)
        let Gustavo_Eduardo_Perez_Villegas = new Docente("Gustavo Eduardo Perez Villegas", "-", "-", "-", "18-21", "18-21", "-", 2)
        let Arturo_Islas_Islas = new Docente("Arturo Islas Islas", "-", "-", "-", "17-21", "17-21", "-", 2)
        //Aqui iria Itzel Yazmin Reyes Aparicio pero como solo tiene horas de estadia no cuenta
        let Ariadna_Itzel_Reyes_Aparicio = new Docente("Ariadna Itzel Reyes Aparicio", "10-12", "-", "-", "10-12", "7-10", "-", 2)

        let Julio_Marquez_Rodriguez = new Docente("Julio Marquez Rodriguez", "9-17", "9-17", "9-17", "9-17", "9-17", "-", 4)
        let Brenda_Garcia_Reyes = new Docente("Brenda Garcia Reyes", "9-17", "9-17", "9-17", "9-17", "9-17", "-", 4)
        let Alonzo_Lara_Flores = new Docente("Alonzo Lara Flores", "7-15", "7-15", "9-17", "9-17", "7-15", "-", 4)
        let Andres_Dimas_Espino = new Docente("Andres Dimas Espino", "7-15", "7-15", "7-15", "7-15", "7-15", "-", 4)

        let Brayam_Mauricio_Guillermo = new Docente("Brayam Mauricio Guillermo", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        let Selene_Amellali_Torres = new Docente("Selene Amellali Torres", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        let Armando_Martinez_Acevedo = new Docente("Armando Martinez Acevedo", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        
        

        //Funcion para calcular las horas disponibles de los docentes por dia
        function calcularHorasDisponibles(disponibilidad_cadena) {
            
            if (disponibilidad_cadena === "-" || disponibilidad_cadena.trim() === "") {
                return 0;
            }

            const total_horas = disponibilidad_cadena
            .split(" ")
            .map(rango => {
                const [inicio, fin] = rango.split("-").map(h => parseInt(h))

                if (isNaN(inicio) || isNaN(fin)) {
                    return 0;
                }

                return fin - inicio;
            })
            .reduce((acumulador, duracion) => {
                return acumulador + duracion
            }, 0);

            return total_horas;
        }

        // bucle para calcular la cantidad de horas disponibles por docente
        for (const docente of Docente.lista_docentes) {
            docente.horas_lunes = calcularHorasDisponibles(docente.dispoinibilidad_lunes)
            docente.horas_martes = calcularHorasDisponibles(docente.dispoinibilidad_martes)
            docente.horas_miercoles = calcularHorasDisponibles(docente.dispoinibilidad_miercoles)
            docente.horas_jueves = calcularHorasDisponibles(docente.dispoinibilidad_jueves)
            docente.horas_viernes = calcularHorasDisponibles(docente.dispoinibilidad_viernes)
            docente.horas_sabado = calcularHorasDisponibles(docente.dispoinibilidad_sabado)

            docente.horas_disponibilidad = docente.horas_lunes + docente.horas_martes + docente.horas_miercoles + docente.horas_jueves + docente.horas_viernes + docente.horas_sabado
        }


        //Asignacion docente-materia-grupo
        //LAGE_1ro_NA_A
        LAGE_1ro_NA_A.asignarDocenteAMateria("INGLES I", Brayam_Mauricio_Guillermo)
        LAGE_1ro_NA_A.asignarDocenteAMateria("TUTORIA 1RO", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_A.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Irma_Elizabeth_Bautista_Valencia)
        LAGE_1ro_NA_A.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Marco_Antonio_Hernandez_Granados)
        LAGE_1ro_NA_A.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("COMUNICACION Y HABILIDADES DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        

        //LAGE_1ro_NA_B
        LAGE_1ro_NA_B.asignarDocenteAMateria("INGLES I", Selene_Amellali_Torres)
        LAGE_1ro_NA_B.asignarDocenteAMateria("TUTORIA 1RO", Andres_Dimas_Espino)
        LAGE_1ro_NA_B.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_B.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Ariadna_Itzel_Reyes_Aparicio)
        LAGE_1ro_NA_B.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Andres_Dimas_Espino)
        LAGE_1ro_NA_B.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_B.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_B.asignarDocenteAMateria("COMUNICACION Y HABILIDADES DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        

        //LAGE_1ro_NA_C
        LAGE_1ro_NA_C.asignarDocenteAMateria("INGLES I", Armando_Martinez_Acevedo)
        LAGE_1ro_NA_C.asignarDocenteAMateria("TUTORIA 1RO", Alonzo_Lara_Flores)
        LAGE_1ro_NA_C.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_C.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Alonzo_Lara_Flores)
        LAGE_1ro_NA_C.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Daniela_Placido_Soriano)
        LAGE_1ro_NA_C.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_C.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_C.asignarDocenteAMateria("COMUNICACION Y HABILIDADES_DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        
        

        


        //Funcion para determinar el orden en el que se crearan los horarios de los docentes
        for (const docente of Docente.lista_docentes) {

            if(docente.dispoinibilidad_lunes !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_martes !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_miercoles !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_jueves !== "-"){
                docente.cantidad_dias_disponibles += 1   
            }
            if(docente.dispoinibilidad_viernes !== "-"){
                docente.cantidad_dias_disponibles += 1  
            }
            if(docente.dispoinibilidad_sabado !== "-"){
                docente.cantidad_dias_disponibles += 1  
            }


            // 2. Calcular prioridad evitando división por cero
            if (docente.horas_carga > 0) {
                docente.prioridad = (docente.horas_disponibilidad / docente.horas_carga) * (docente.cantidad_dias_disponibles) * (docente.tipo_docente);
            } else {
                docente.prioridad = 0; // O la lógica que prefieras para docentes sin carga
            }
            
        }
        //reacomodamos la lista de docentes segun su prioridad
        Docente.lista_docentes.sort((a, b) => a.prioridad - b.prioridad);
        Docente.lista_docentes.forEach((docente, index) => {
            console.log(`${index + 1}. Docente: ${docente.nombre_docente} | Prioridad: ${docente.prioridad.toFixed(2)} | Carga: ${docente.horas_carga}`)
        })

        
        //Esta funcion revisa si una hora es disponible para el excel de disponibilidad docente
        function estaDisponible(hora, disponibilidad_cadena) {
            if (!disponibilidad_cadena || disponibilidad_cadena === "-") return false;
    
            // Separamos por espacios por si hay rangos múltiples
            const rangos = disponibilidad_cadena.split(" ");
    
            return rangos.some(rango => {
                const [inicio, fin] = rango.split("-").map(Number);
                // Verificamos si la hora está dentro del rango
                // Usamos >= inicio y < fin (común en horarios)
                return hora >= inicio && hora < fin;
            })
        }

        console.log(Brayam_Mauricio_Guillermo.nombre_docente + Brayam_Mauricio_Guillermo.lista_horas_lunes_docente)

        //Apartir de este punto, todo lo de arriba se creo para la funcion que esta debajo
        //Funcion principal, para lo que se hizo todo esto pues----------------------------------------------------------------------------------------------------------------------------------------------
        function crear_horarios_grupos_y_docentes() {
            Docente.lista_docentes.forEach((docente) => {
                //El condicional de abajo ayuda con los docentes de ingles, como ellos son de tipo 1, son los primeros en ser acomodados debido a las placas
                if (docente.tipo_docente === 1) {
                    docente.materias_impartidas_docente.forEach((materia) => {
                        const grupo = materia.grupo;
                        const dias = ["lunes", "martes", "miercoles", "jueves", "viernes"];
                    
                        dias.forEach((dia, index) => {
                            const numHorasNecesarias = materia.desglose_horas[`horas_clase_${index + 1}`];
                            if (numHorasNecesarias <= 0) return;
                        
                            const propDocente = `lista_horas_${dia}_docente`;
                            const propGrupo = `horario_${dia}_grupo`;
                        
                            // 1. Buscamos horas donde AMBOS (grupo y docente) tengan números (estén libres)
                            const horasDisponiblesComunes = grupo[propGrupo].filter(h => 
                                typeof h === 'number' && typeof docente[propDocente].find(dh => dh === h) === 'number'
                            );
                        
                            let horasAAsignar = [];
                        
                            // 2. Lógica de selección según la materia
                            if (materia.nombre_materia === "INGLES VII") {
                                // Tomamos las últimas horas disponibles (final de jornada)
                                horasAAsignar = horasDisponiblesComunes.slice(-numHorasNecesarias)

                            } else if (materia.nombre_materia === "INGLES I" || materia.nombre_materia === "INGLES IV") {
                                // Tomamos las primeras horas disponibles (inicio de jornada)
                                horasAAsignar = horasDisponiblesComunes.slice(0, numHorasNecesarias);
                            }
                        
                            // 3. Si encontramos horas suficientes, las asignamos
                            if (horasAAsignar.length > 0) {
                                // Actualizar GRUPO
                                grupo[propGrupo] = grupo[propGrupo].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${docente.nombre_docente}` : h
                                );
                            
                                // Actualizar DOCENTE
                                docente[propDocente] = docente[propDocente].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${grupo.nombre_grupo}` : h
                                );
                            }
                        })
                    })
  
                }
                
                //El condicional de abajo ayuda con los docentes por asignatura PAs, como ellos son de tipo 2, se les da prioridad por encima de los demas docentes, pero van despues de los docentes de ingles
                else if (docente.tipo_docente === 2) {
                    // 1. Calculamos el ranking de días UNA SOLA VEZ para el docente
                    // Basado en su disponibilidad general (asumimos que los grupos tienen espacios similares)
                    const diasSemana = ["lunes", "martes", "miercoles", "jueves", "viernes"];

                    const rankingDiasDocente = diasSemana.map((dia, index) => {
                        const propDocente = `lista_horas_${dia}_docente`;
                        // Aquí solo contamos cuántas horas tiene el docente libres originalmente
                        const libres = docente[propDocente].filter(h => typeof h === 'number').length;
                        return { dia, index, libres };
                    });
                
                    // Determinamos cuántos días quiere el docente según su carga total
                    const diasASeleccionar = docente.horas_carga <= 10 ? 2 : 3;
                    const diasElegidos = rankingDiasDocente
                        .sort((a, b) => b.libres - a.libres)
                        .slice(0, diasASeleccionar)
                        .map(info => info.dia); // Solo nos quedamos con los nombres ["lunes", "martes", ...]
                
                    // 2. Ahora iteramos sus materias y las metemos SOLO en esos días elegidos
                    docente.materias_impartidas_docente.forEach((materia) => {
                        const grupo = materia.grupo;
                    
                        diasElegidos.forEach((dia) => {
                            // Necesitamos el índice original (0-4) para el desglose_horas
                            const indexDia = diasSemana.indexOf(dia);
                            const numHorasNecesarias = materia.desglose_horas[`horas_clase_${indexDia + 1}`];
                        
                            if (numHorasNecesarias <= 0) return;
                        
                            const propDocente = `lista_horas_${dia}_docente`;
                            const propGrupo = `horario_${dia}_grupo`;
                        
                            // 3. Buscar horas comunes LIBRES en este momento
                            const horasComunes = grupo[propGrupo].filter(h => 
                                typeof h === 'number' && docente[propDocente].includes(h)
                            );
                        
                            let horasAAsignar = [];
                            if (materia.turno_materia === "VESPERTINO") {
                                horasAAsignar = horasComunes.slice(-numHorasNecesarias);
                            } else {
                                horasAAsignar = horasComunes.slice(0, numHorasNecesarias);
                            }
                        
                            // 4. Asignación
                            if (horasAAsignar.length > 0) {
                                grupo[propGrupo] = grupo[propGrupo].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${docente.nombre_docente}` : h
                                );
                            
                                docente[propDocente] = docente[propDocente].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${grupo.nombre_grupo}` : h
                                );
                            }
                        });
                    });
                }
                //El condicional de abajo ayuda con los docentes PTCs, como ellos son de tipo 3, se les da prioridad por encima de los demas docentes, pero van despues de los docentes de los PAs
                //El condicional de abajo ayuda con los docentes administractivos, como ellos son de tipo 4, se les da prioridad por debajo de todos los demas docentes
                else if(docente.tipo_docente === 3 || docente.tipo_docente === 4){
                    docente.materias_impartidas_docente.forEach((materia) => {
                        const grupo = materia.grupo;
                        const diasSemana = ["lunes", "martes", "miercoles", "jueves", "viernes"];

                        diasSemana.forEach((dia, index) => {
                            // Obtenemos cuántas horas necesita esta materia en este día específico
                            const numHorasNecesarias = materia.desglose_horas[`horas_clase_${index + 1}`];

                            // Si el desglose para este día es 0, saltamos al siguiente día
                            if (numHorasNecesarias <= 0) return;
                        
                            const propDocente = `lista_horas_${dia}_docente`;
                            const propGrupo = `horario_${dia}_grupo`;
                        
                            // Buscamos horas donde ambos estén disponibles (que el valor sea un número)
                            const horasComunes = grupo[propGrupo].filter(h => 
                                typeof h === 'number' && docente[propDocente].includes(h)
                            );
                        
                            let horasAAsignar = [];
                            // Respetamos el turno (Matutino toma las primeras, Vespertino las últimas)
                            if (materia.turno_materia === "VESPERTINO") {
                                horasAAsignar = horasComunes.slice(-numHorasNecesarias);
                            } else {
                                horasAAsignar = horasComunes.slice(0, numHorasNecesarias);
                            }
                        
                            // Si hay espacio suficiente, hacemos la asignación
                            if (horasAAsignar.length > 0) {
                                // Marcamos el horario del Grupo
                                grupo[propGrupo] = grupo[propGrupo].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${docente.nombre_docente}` : h
                                );
                            
                                // Marcamos el horario del Docente
                                docente[propDocente] = docente[propDocente].map(h => 
                                    horasAAsignar.includes(h) ? `${materia.nombre_materia} - ${grupo.nombre_grupo}` : h
                                );
                            }
                        });
                    });

                }

            })
        }
        crear_horarios_grupos_y_docentes()
        
        //Funcion de impresion en el excel--------------------------------------------------------------------------------------------------------------------------------------------------------------------
        button_accion.addEventListener("click", descargar_documentos)

        //Funcion de descarga del excel de disponibilidades de docentes
        function generar_excel_disponibilidad_docentes() {
            // 1. Crear un nuevo libro de trabajo (Workbook)
            const workbook = XLSX.utils.book_new();

            // 3. Iterar la lista y crear una hoja por cada docente
            Docente.lista_docentes.forEach(docente => {
                const filasDeHoras = HORAS.map(hora => [hora]);

                const datosHoja = [
                    ["Docente: " + docente.nombre_docente], // Fila 1 (A1)
                    ["Disponbilidad total (horas): " + docente.horas_disponibilidad], // Fila 1 (A2)
                    ["Horas carga (horas): " + docente.horas_carga], // Fila 3 (A3)
                    ["DÍAS:", ...DIAS.map(d => d.toUpperCase())] // Fila 3 (A4) en diferentes columnas
                    
                ]

                HORAS.forEach(hora => {
                    // La primera columna es la hora
                    const fila = [hora]; 

                    // Recorremos cada día para ver si ponemos "X" o vacío
                    DIAS.forEach(dia => {
                        // Accedemos a la propiedad dinámica: docente.dispoinibilidad_lunes, etc.
                        const dispDia = docente[`dispoinibilidad_${dia}`];
                
                        if (estaDisponible(hora, dispDia)) {
                            fila.push("X"); // Marcamos con una X si está disponible
                        } else {
                            fila.push(""); // Vacío si no
                        }
                    })

                    datosHoja.push(fila)
                })
                
                
                // Creamos una hoja de un array de impresion.
                const worksheet = XLSX.utils.aoa_to_sheet(datosHoja)

                // Limpiar nombre (máximo 31 caracteres y quitar caracteres prohibidos)
                const nombreHoja = docente.nombre_docente.substring(0, 31)

                // 4. Añadir la hoja al libro con el nombre del docente
                XLSX.utils.book_append_sheet(workbook, worksheet, nombreHoja)
            })

            // 5. Generar y descargar el archivo
            // Esta función en el navegador dispara la descarga automáticamente
            XLSX.writeFile(workbook, 'Disponibilidad_docentes.xlsx');
        }

        //Funcion de descarga del excel de disponibilidades de los horarios de los grupos
        function generar_excel_horarios_grupos() {
            const workbook = XLSX.utils.book_new();

            // Definimos el orden de las columnas y a qué propiedad del objeto pertenecen
            const columnasConfig = [
                { etiqueta: "LUNES", propiedad: "horario_lunes_grupo" },
                { etiqueta: "MARTES", propiedad: "horario_martes_grupo" },
                { etiqueta: "MIERCOLES", propiedad: "horario_miercoles_grupo" },
                { etiqueta: "JUEVES", propiedad: "horario_jueves_grupo" },
                { etiqueta: "VIERNES", propiedad: "horario_viernes_grupo" },
                { etiqueta: "SABADO", propiedad: "horario_sabado_grupo" }
            ];

            Grupo.lista_grupos_LAGE.forEach(grupo => {
                const datosHoja = [
                    ["Horario del grupo: " + grupo.nombre_grupo],
                    [],
                    ["HORA", ...columnasConfig.map(c => c.etiqueta)]
                ];
            
                // Usamos un índice (0, 1, 2...) para recorrer las posiciones de los arrays
                // Asumiendo que todos los arrays de horarios tienen el mismo largo (ej. 14 posiciones)
                const totalFilas = grupo.horario_lunes_grupo.length;
            
                for (let i = 0; i < totalFilas; i++) {
                    // La "Hora" de referencia la sacamos de la constante global HORAS usando el mismo índice
                    const horaReferencia = HORAS[i] || ""; 
                    const fila = [horaReferencia];
                
                    // Para cada día, extraemos lo que haya en la posición 'i' del array de ese grupo
                    columnasConfig.forEach(col => {
                        const contenido = grupo[col.propiedad][i];

                        // Si el contenido es un número, significa que está vacía (solo es la hora)
                        // Si es un texto, es la materia con el docente.
                        if (typeof contenido === "number") {
                            fila.push(""); // Dejamos vacío en el Excel si no hay materia
                        } else {
                            fila.push(contenido); // Ponemos "MATEMATICAS - Alonzo..."
                        }
                    });
                
                    datosHoja.push(fila);
                }
            
                const worksheet = XLSX.utils.aoa_to_sheet(datosHoja);
            
                // Configuración de anchos: La columna A es corta, las de materias son anchas
                worksheet['!cols'] = [{ wch: 8 }, ...columnasConfig.map(() => ({ wch: 35 }))];
            
                const nombreLimpio = grupo.nombre_grupo.toString().replace(/[\\\/\?\*\[\]]/g, "").substring(0, 31);
                XLSX.utils.book_append_sheet(workbook, worksheet, nombreLimpio);
            });
        
            XLSX.writeFile(workbook, 'Horarios_Grupos_LAGE.xlsx');
        }

        //Funcion de descarga del excel de los horarios de los docentes
        function generar_excel_horarios_docentes() {
            const workbook = XLSX.utils.book_new();

            const columnasConfig = [
                { etiqueta: "LUNES", propiedad: "lista_horas_lunes_docente" },
                { etiqueta: "MARTES", propiedad: "lista_horas_martes_docente" },
                { etiqueta: "MIERCOLES", propiedad: "lista_horas_miercoles_docente" },
                { etiqueta: "JUEVES", propiedad: "lista_horas_jueves_docente" },
                { etiqueta: "VIERNES", propiedad: "lista_horas_viernes_docente" },
                { etiqueta: "SABADO", propiedad: "lista_horas_sabado_docente" }
            ];

            Docente.lista_docentes.forEach(docente => {
                // CORRECCIÓN: Usar el nombre de la instancia del docente
                const nombreDocenteStr = docente.nombre_docente || "Sin Nombre";
            
                const datosHoja = [
                    ["Horario del docente: " + nombreDocenteStr],
                    [],
                    ["HORA", ...columnasConfig.map(c => c.etiqueta)]
                ];
            
                // Obtenemos el largo del array de este docente específico
                const totalFilas = docente.lista_horas_lunes_docente.length;
            
                for (let i = 0; i < totalFilas; i++) {
                    const horaReferencia = HORAS[i] || ""; 
                    const fila = [horaReferencia];
                
                    columnasConfig.forEach(col => {
                        // CORRECCIÓN: Cambiar 'grupo' por 'docente'
                        const contenido = docente[col.propiedad][i];

                        // Lógica de impresión: si es número (hora vacía) queda en blanco,
                        // si es texto (Materia - Grupo) se imprime.
                        if (typeof contenido === "number") {
                            fila.push(""); 
                        } else {
                            fila.push(contenido); 
                        }
                    });
                
                    datosHoja.push(fila);
                }
            
                const worksheet = XLSX.utils.aoa_to_sheet(datosHoja);
            
                worksheet['!cols'] = [{ wch: 10 }, ...columnasConfig.map(() => ({ wch: 40 }))];
            
                // CORRECCIÓN: Limpiar el nombre usando la variable de la instancia
                const nombreLimpio = nombreDocenteStr.toString()
                    .replace(/[\\\/\?\*\[\]]/g, "")
                    .substring(0, 31);
            
                XLSX.utils.book_append_sheet(workbook, worksheet, nombreLimpio);
            });
        
            XLSX.writeFile(workbook, 'Horarios_Docentes_LAGE.xlsx');
        }

        //Funcion madre de descarga de documentos
        function descargar_documentos(){
            generar_excel_disponibilidad_docentes()
            generar_excel_horarios_grupos()
            generar_excel_horarios_docentes()

        }



    </script>
</body>
</html>