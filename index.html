<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horarios</title>

    <style>
        :root{
            --color-yellow: #FCB814;
            --color-black: #221F20;
        }

        body{
            width: 100%;
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }

        header{
            width: 100%;
            height: 8%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            background-color: var(--color-black);
            padding: 0;
            margin: 0;
        }

        header a{
            width: 3rem;
            height: 3rem;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 3rem 0 3rem;
            margin: 0;
        }

        header a img{
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        main{
            width: 100%;
            height: 92%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            background-color: var(--color-yellow);
            padding: 0;
            margin: 0;
        }
    </style>

</head>
<body>

    <header>
        <a href=""><img src="./assets/ICON-BRUTO-FI-YELLOW.png" alt="LOGO"></a>
    </header>

    <main>
        <button class="button_accion" id="button_accion">Descargar excel</button>
    </main>
    
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>

        let button_accion = document.getElementById("button_accion")

        const DIAS = ["lunes", "martes", "miercoles", "jueves", "viernes", "sabado"]
        const HORAS = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
        
        // --- CLASE MATERIA ---
        class Materia {
            constructor(nombre_materia, horas_materia, grado_materia, turno_materia, tsu_materia) {
                this.nombre_materia = nombre_materia;
                this.horas_materia = horas_materia;
                this.grado_materia = grado_materia;
                this.turno_materia = turno_materia;
                this.tsu_materia = tsu_materia;
                this.docente = null; // Inicializa la referencia al docente

                this.desglose_horas = {
                    horas_clase_1: 0,
                    horas_clase_2: 0,
                    horas_clase_3: 0,
                    horas_clase_4: 0,
                    horas_clase_5: 0,
                    horas_clase_6: 0,
                    horas_clase_7: 0,
                    horas_clase_8: 0,
                    horas_clase_9: 0,
                    horas_clase_10: 0,
                    horas_clase_11: 0,
                    horas_clase_12: 0,
                    horas_clase_13: 0,
                    horas_clase_14: 0,
                    horas_clase_15: 0,
                    horas_clase_16: 0,
                    horas_clase_17: 0,
                    horas_clase_18: 0,
                    horas_clase_19: 0,
                    horas_clase_20: 0
                }
            }

            determinar_horas_clase_por_materia(){
                const tipo = this.docente.tipo_docente;
                const horas = this.horas_materia;
                // Referencia corta para no escribir tanto
                const d = this.desglose_horas; 

                // Particion para Ingles (Tipo 1) esto se determina por el tipo de docnete
                if (tipo === 1) {
                    if (horas == 5) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; }
                    else if (horas == 7) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; }
                    else if (horas == 8) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; d.horas_clase_8 = 1; }
                    else if (horas == 9) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; d.horas_clase_8 = 1; d.horas_clase_9 = 1; }
                    else if (horas == 10) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; d.horas_clase_8 = 1; d.horas_clase_9 = 1; d.horas_clase_10 = 1; }
                    else if (horas == 15) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; d.horas_clase_8 = 1; d.horas_clase_9 = 1; d.horas_clase_10 = 1; d.horas_clase_11 = 1; d.horas_clase_12 = 1; d.horas_clase_13 = 1; d.horas_clase_14 = 1; d.horas_clase_15 = 1; }
                    else if (horas == 20) { d.horas_clase_1 = 1; d.horas_clase_2 = 1; d.horas_clase_3 = 1; d.horas_clase_4 = 1; d.horas_clase_5 = 1; d.horas_clase_6 = 1; d.horas_clase_7 = 1; d.horas_clase_8 = 1; d.horas_clase_9 = 1; d.horas_clase_10 = 1; d.horas_clase_11 = 1; d.horas_clase_12 = 1; d.horas_clase_13 = 1; d.horas_clase_14 = 1; d.horas_clase_15 = 1; d.horas_clase_16 = 1; d.horas_clase_17 = 1; d.horas_clase_18 = 1; d.horas_clase_19 = 1; d.horas_clase_20 = 1;}
                }
                // Particion para PA
                else if (tipo === 2) {
                    if (horas == 1) { d.horas_clase_1 = 1 }
                    else if (horas == 2) { d.horas_clase_1 = 2 }
                    else if (horas == 3) { d.horas_clase_1 = 2; d.horas_clase_2 = 1 }
                    else if (horas == 4) { d.horas_clase_1 = 2; d.horas_clase_2 = 2;}
                    else if (horas == 5) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; }
                    else if (horas == 7) { d.horas_clase_1 = 3; d.horas_clase_2 = 2; d.horas_clase_3 = 2 }
                }
                else if (tipo === 3 || tipo === 4) {
                    if (horas == 1) { d.horas_clase_1 = 1 }
                    else if (horas == 2) { d.horas_clase_1 = 1; d.horas_clase_2 = 1 }
                    else if (horas == 3) { d.horas_clase_1 = 2; d.horas_clase_2 = 1 }
                    else if (horas == 4) { d.horas_clase_1 = 2; d.horas_clase_2 = 2 }
                    else if (horas == 5) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 1; }
                    else if (horas == 6) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; }
                    else if (horas == 7) { d.horas_clase_1 = 2; d.horas_clase_2 = 2; d.horas_clase_3 = 2; d.horas_clase_4 = 1 }
                }

            }

            asignarDocente(docente) {
                if (docente instanceof Docente) {
                    this.docente = docente;
                    docente.agregarMateria(this); 
                    // ¡Llamarlo aquí asegura que las horas se repartan en cuanto llega el docente!
                    this.determinar_horas_clase_por_materia(); 
                }
            }
        }
        
        // Materias 1° cuatrimestre LAGE_NA
        let TUTORIA_1RO = new Materia("TUTORIA 1RO", 2, 1, "MATUTINO", "NA")
        let DESARROLLO_HUMANO_Y_VALORES = new Materia("DESARROLLO HUMANO Y VALORES", 4, 1, "MATUTINO", "NA");
        let FUNDAMENTOS_MATEMATICOS = new Materia("FUNDAMENTOS MATEMATICOS", 7, 1, "MATUTINO", "NA");
        let FUNDAMENTOS_DE_LA_ADMINISTRACION = new Materia("FUNDAMENTOS DE LA ADMINISTRACION", 4, 1, "MATUTINO", "NA");
        let CONTABILIDAD_I = new Materia("CONTABILIDAD I", 6, 1, "MATUTINO", "NA");
        let MARCO_LEGAL_DE_LAS_ORGANIZACIONES = new Materia("MARCO LEGAL DE LAS ORGANIZACIONES", 4, 1, "MATUTINO", "NA");
        let COMUNICACION_Y_HABILIDADES_DIGITALES = new Materia("COMUNICACION Y HABILIDADES DIGITALES", 5, 1, "MATUTINO", "NA");
        let INGLES_I = new Materia("INGLES I", 15, 1, "MATUTINO", "NA");

        // Materias 4° cuatrimestre (Gestion del capital humano / GCH) 
        let TUTORIA_4TO_GCH = new Materia("TUTORIA 4TO GCH", 2, 4, "VESPERTINO", "GCH")
        let ETICA_PROFESIONAL_GCH = new Materia("ETICA PROFESIONAL GCH", 4, 4, "VESPERTINO", "GCH");
        let GESTION_DEL_CAPITAL_HUMANO = new Materia("GESTION DEL CAPITAL HUMANO", 5, 4, "VESPERTINO", "GCH");
        let INTEGRACIÓN_DEL_CAPITAL_HUMANO = new Materia("INTEGRACION DEL CAPITAL HUMANO", 5, 4, "VESPERTINO", "GCH");
        let COMPORTAMIENTO_ORGANIZACIONAL = new Materia("COMPORTAMIENTO ORGANIZACIONAL", 5, 4, "VESPERTINO", "GCH");
        let SUELDOS_Y_SALARIOS_I = new Materia("SUELDOS Y SALARIOS I", 7, 4, "VESPERTINO", "GCH");
        let LEGISLACION_LABORAL = new Materia("LEGISLACION LABORAL", 4, 4, "VESPERTINO", "GCH");
        let INGLES_IV_GCH = new Materia("INGLES IV GCH", 8, 4, "VESPERTINO", "GCH");

        // Materias 4° cuatrimestre (Emprendimiento y formulacion y evaluacion de proyectos / EFEP)
        let TUTORIA_4TO_EFEP = new Materia("TUTORIA 4TO EFEP", 2, 4, "VESPERTINO", "EFEP")
        let ETICA_PROFESIONAL_EFEP = new Materia("ETICA PROFESIONAL EFEP", 4, 4, "VESPERTINO", "EFEP");
        let INNOVACION_Y_EMPRENDIMIENTO = new Materia("INNOVACION Y EMPRENDIMIENTO", 5, 4, "VESPERTINO", "EFEP");
        let ESTUDIO_DE_MERCADO = new Materia("ESTUDIO DE MERCADO", 6, 4, "VESPERTINO", "EFEP");
        let ADMINISTRACIÓN_DE_PROYECTOS_I = new Materia("ADMINISTRACIÓN DE PROYECTOS I", 5, 4, "VESPERTINO", "EFEP");
        let FUNDAMENTOS_DE_SISTEMAS_DE_PRODUCCIÓN = new Materia("FUNDAMENTOS DE SISTEMAS DE PRODUCCION", 4, 4, "VESPERTINO", "EFEP");
        let ESTUDIO_TÉCNICO_Y_ORGANIZACIONAL = new Materia("ESTUDIO TÉCNICO Y ORGANIZACIONAL", 6, 4, "VESPERTINO", "EFEP");
        let INGLES_IV_EFEP = new Materia("INGLES IV EFEP", 8, 4, "VESPERTINO", "EFEP");

        // Materias 7° cuatrimestre LAGE_NA
        let TUTORIA_7MO = new Materia("TUTORIA 7MO", 2, 7, "VESPERTINO", "NA")
        let COMERCIO_INTERNACIONAL = new Materia("COMERCIO INTERNACIONAL", 5, 7, "VESPERTINO", "NA")
        let SUSTENTABILIDAD = new Materia("SUSTENTABILIDAD", 5, 7, "VESPERTINO", "NA")
        let CONTRIBUCIONES_FISCALES = new Materia("CONTRIBUCIONES FISCALES", 6, 7, "VESPERTINO", "NA")
        let ADMINISTRACION_DE_LA_PRODUCCION = new Materia("ADMINISTRACION DE LA PRODUCCION", 6, 7, "VESPERTINO", "NA")
        let TECNOLOGIAS_DE_LA_INFORMACION_APLICADA_A_LOS_NEGOCIOS = new Materia("TECNOLOGIAS DE LA INFORMACION APLICADA A LOS NEGOCIOS", 4, 7, "VESPERTINO", "NA")
        let SEMINARIO_DE_LA_INNOVACION = new Materia("SEMINARIO DE LA INNOVACION", 5, 7, "VESPERTINO", "NA")
        let INGLES_VII = new Materia("INGLES VII", 5, 7, "VESPERTINO", "EFEP")

        let lista_materias_LAGE_1ro_A = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_1ro_B = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_1ro_C = [
            TUTORIA_1RO,
            DESARROLLO_HUMANO_Y_VALORES,
            FUNDAMENTOS_MATEMATICOS,
            FUNDAMENTOS_DE_LA_ADMINISTRACION,
            CONTABILIDAD_I,
            MARCO_LEGAL_DE_LAS_ORGANIZACIONES,
            COMUNICACION_Y_HABILIDADES_DIGITALES,
            INGLES_I
        ]

        let lista_materias_LAGE_4to_GCH = [
            TUTORIA_4TO_GCH,
            ETICA_PROFESIONAL_GCH,
            GESTION_DEL_CAPITAL_HUMANO,
            INTEGRACIÓN_DEL_CAPITAL_HUMANO,
            COMPORTAMIENTO_ORGANIZACIONAL,
            SUELDOS_Y_SALARIOS_I,
            LEGISLACION_LABORAL,
            INGLES_IV_GCH
        ]

        let lista_materias_LAGE_4to_EFEP = [
            TUTORIA_4TO_EFEP,
            ETICA_PROFESIONAL_EFEP,
            INNOVACION_Y_EMPRENDIMIENTO,
            ESTUDIO_DE_MERCADO,
            ADMINISTRACIÓN_DE_PROYECTOS_I,
            FUNDAMENTOS_DE_SISTEMAS_DE_PRODUCCIÓN,
            ESTUDIO_TÉCNICO_Y_ORGANIZACIONAL,
            INGLES_IV_EFEP
        ]

        let lista_materias_LAGE_7mo = [
            TUTORIA_7MO,
            COMERCIO_INTERNACIONAL,
            SUSTENTABILIDAD,
            CONTRIBUCIONES_FISCALES,
            ADMINISTRACION_DE_LA_PRODUCCION,
            TECNOLOGIAS_DE_LA_INFORMACION_APLICADA_A_LOS_NEGOCIOS,
            SEMINARIO_DE_LA_INNOVACION,
            INGLES_VII
        ]

        //creamos la clase Grupo
        class Grupo {
            static lista_grupos_LAGE = [];

            // Definimos los horarios base como una referencia estática
            static CONFIG_HORARIOS = {
                matutino: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17],
                vespertino: [12, 13, 14, 15, 16, 17, 18, 19, 20]
            };
        
            constructor(nombre_grupo, turno, listaMateriasPlantilla = []) {
                this.nombre_grupo = nombre_grupo;
                this.turno = turno.toLowerCase(); // Normalizamos a minúsculas

                // Seleccionamos el horario base según el turno o un array vacío si no coincide
                const horasBase = Grupo.CONFIG_HORARIOS[this.turno] || [];
            
                // Inicializamos los días. Usamos spread [...] para que cada día sea un array independiente
                this.horario_lunes_grupo = [...horasBase];
                this.horario_martes_grupo = [...horasBase];
                this.horario_miercoles_grupo = [...horasBase];
                this.horario_jueves_grupo = [...horasBase];
                this.horario_viernes_grupo = [...horasBase];
                this.horario_sabado_grupo = [...horasBase];
            
                this.materias = [];
            
                // Clonación de materias
                listaMateriasPlantilla.forEach(materia => {
                    this.agregarMateria(materia);
                });
            
                Grupo.lista_grupos_LAGE.push(this);
            }
        
            agregarMateria(materia) {
                if (materia instanceof Materia) {
                    const materiaClonada = new Materia(
                        materia.nombre_materia,
                        materia.horas_materia,
                        materia.grado_materia,
                        materia.turno_materia,
                        materia.tsu_materia
                    );
                    materiaClonada.grupo = this;
                    this.materias.push(materiaClonada);
                }
            }
        
            asignarDocenteAMateria(nombreMateria, docente) {
                const materiaEncontrada = this.materias.find(m => m.nombre_materia === nombreMateria);
                if (materiaEncontrada && docente instanceof Docente) {
                    materiaEncontrada.asignarDocente(docente);
                }
            }
        }

        //creamos los grupos de LAGE
        let LAGE_1ro_NA_A = new Grupo("LAGE_1ro_NA_A", "matutino" , lista_materias_LAGE_1ro_A)
        let LAGE_1ro_NA_B = new Grupo("LAGE_1ro_NA_B", "matutino", lista_materias_LAGE_1ro_B)
        let LAGE_1ro_NA_C = new Grupo("LAGE_1ro_NA_C", "matutino", lista_materias_LAGE_1ro_C)

        let LAGE_4to_GCH_A = new Grupo("LAGE_4to_GCH_A", "vespertino", lista_materias_LAGE_4to_GCH)
        
        let LAGE_4to_EFEP_A = new Grupo("LAGE_4to_EFEP_A", "vespertino", lista_materias_LAGE_4to_EFEP)
        let LAGE_4to_EFEP_B = new Grupo("LAGE_4to_EFEP_B", "vespertino", lista_materias_LAGE_4to_EFEP)

        let LAGE_7mo_NA_A = new Grupo("LAGE_7mo_NA_A", "vespertino", lista_materias_LAGE_7mo)
        let LAGE_7mo_NA_B = new Grupo("LAGE_7mo_NA_B", "vespertino", lista_materias_LAGE_7mo)
        let LAGE_7mo_NA_C = new Grupo("LAGE_7mo_NA_C", "vespertino", lista_materias_LAGE_7mo)




            // --- CLASE DOCENTE
        class Docente {
            static lista_docentes = []
            constructor(nombre_docente, dispoinibilidad_lunes, dispoinibilidad_martes, dispoinibilidad_miercoles, dispoinibilidad_jueves, dispoinibilidad_viernes, dispoinibilidad_sabado, tipo_docente) {
                this.nombre_docente = nombre_docente
                this.dispoinibilidad_lunes = dispoinibilidad_lunes;
                this.horas_lunes = 0;
                this.lista_horas_lunes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_lunes)
                this.dispoinibilidad_martes = dispoinibilidad_martes
                this.horas_martes = 0;
                this.lista_horas_martes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_martes)
                this.dispoinibilidad_miercoles = dispoinibilidad_miercoles
                this.horas_miercoles = 0;
                this.lista_horas_miercoles_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_miercoles)
                this.dispoinibilidad_jueves = dispoinibilidad_jueves
                this.horas_jueves = 0;
                this.lista_horas_jueves_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_jueves)
                this.dispoinibilidad_viernes = dispoinibilidad_viernes
                this.horas_viernes = 0
                this.lista_horas_viernes_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_viernes)
                this.dispoinibilidad_sabado = dispoinibilidad_sabado
                this.horas_sabado = 0
                this.lista_horas_sabado_docente = this.generar_lista_disponibilidad_por_dia_docente(dispoinibilidad_sabado)
                this.tipo_docente = tipo_docente //1 = Ingles, 2 = PA, 3 = PTC, 4 = administractivos
                this.horas_carga = 0
                this.horas_disponibilidad = 0
                this.cantidad_dias_disponibles = 0
                this.prioridad = 0
                this.materias_impartidas_docente = []
                Docente.lista_docentes.push(this)
            }
            //Funcion que crea las listas de horarios de los docentes (Con esto ya empezamos a considerar horarios)
            generar_lista_disponibilidad_por_dia_docente(str){
                if (!str || str === "-") return [];
    
                    let horas = [];
                    const grupos = str.split(" ");
                                                        grupos.forEach(grupo => {
                        const [inicio, fin] = grupo.split("-").map(Number);
                        for (let i = inicio; i < fin; i++) {
                            horas.push(i);
                        }
                    })
                    return horas;
            }
                
            agregarMateria(materia) {
                // Verificamos si la instancia exacta ya está. 
                // Como cada materia clonada es un objeto nuevo, esto debería pasar siempre.
                if (!this.materias_impartidas_docente.includes(materia)) {
                    this.materias_impartidas_docente.push(materia);
                    this.horas_carga += materia.horas_materia;
                }
            }
        
        }

        //declaramos los docentes ----
        let Gabriela_Lazcano_Cortes = new Docente("Gabriela Lazcano Cortes", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 3)
        let Mariana_Santillan_Arroyo = new Docente("Mariana Santillan Arroyo", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 3)
        //let Horacio_Sanchez_Hernandez = new Docente("Horacio_Sanchez_Hernandez", "10-15", "10-15", "7-11 - 14-15", "7-11 14-15", "14-16", "-", 3)
        let Horacio_Sanchez_Hernandez = new Docente("Horacio Sanchez Hernandez", "7-17", "7-17", "7-17", "7-17", "7-17", "-", 3)
        //let Irma_Elizabeth_Bautista_Valencia = new Docente("Irma_Elizabeth_Bautista_Valencia", "13-21", "13-21", "9-11 13-17", "9-11 13-16", "9-11 13-16", "-", 3)
        let Irma_Elizabeth_Bautista_Valencia = new Docente("Irma Elizabeth Bautista Valencia", "7-21", "7-21", "7-21", "7-21", "7-21", "-", 3)

        let Abner_Hesli_Rojas_Calva = new Docente("Abner Hesli Rojas Calva", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        let Carolina_Sosa_Alvarez = new Docente("Carolina Sosa Alvarez", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        //let Marco_Antonio_Hernandez_Granados = new Docente("Marco Antonio Hernandez Granados", "10-21", "10-21", "14-21", "14-21", "14-21", "-", 2)
        let Marco_Antonio_Hernandez_Granados = new Docente("Marco Antonio Hernandez Granados", "7-21", "7-21", "7-21", "7-21", "7-21", "-", 2)
        //let Karla_Escalante_Alarcon = new Docente("Karla Escalante Alarcon", "7-21", "7-21", "7-21", "7-21", "7-21", "-", 2)
        let Karla_Escalante_Alarcon = new Docente("Karla Escalante Alarcon", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        //let Mitzi_Ailed_Rosario_Moreno_Ramirez = new Docente("Mitzi Ailed Rosario Moreno Ramirez", "7-17", "16-21", "13-15", "16-21", "7-17", "-", 2)
        let Mitzi_Ailed_Rosario_Moreno_Ramirez = new Docente("Mitzi Ailed Rosario Moreno Ramirez", "7-21", "7-21", "7-21", "7-21", "7-21", "-", 2)
        let Arturo_Martinez_Sandoval = new Docente("Arturo Martinez Sandoval", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        let Juan_Carlos_Rodriguez_Olmedo = new Docente("Juan Carlos Rodriguez Olmedo", "12-21", "12-21", "12-21", "12-21", "12-21", "-", 2)
        let Guillermo_Nicolas_Martinez_Sanchez = new Docente("Guillermo Nicolas Martinez Sanchez", "10-18", "10-18", "7-15", "-", "-", "-", 2)
        let Ivan_De_La_Selva_Hernandez = new Docente("Ivan De La Selva Hernandez", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        //let Daniela_Placido_Soriano = new Docente("Daniela Placido Soriano", "10-16", "10-16", "9-11 12-16", "9-11 12-16", "9-11 12-16", "-", 2)
        let Daniela_Placido_Soriano = new Docente("Daniela Placido Soriano", "7-17", "7-17", "7-17", "7-17", "7-17", "-", 2)
        let Cristian_Arturo_Granados_Herrera = new Docente("Cristian Arturo Granados Herrera", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        let Gustavo_Eduardo_Perez_Villegas = new Docente("Gustavo Eduardo Perez Villegas", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        let Arturo_Islas_Islas = new Docente("Arturo Islas Islas", "13-21", "13-21", "13-21", "13-21", "13-21", "-", 2)
        //Aqui iria Itzel Yazmin Reyes Aparicio pero como solo tiene horas de estadia no cuenta
        let Ariadna_Itzel_Reyes_Aparicio = new Docente("Ariadna Itzel Reyes Aparicio", "10-12", "-", "-", "9-11", "7-10", "-", 1)

        let Julio_Marquez_Rodriguez = new Docente("Julio Marquez Rodriguez", "9-17", "9-17", "9-17", "9-17", "9-17", "-", 4)
        let Brenda_Garcia_Reyes = new Docente("Brenda Garcia Reyes", "9-17", "9-17", "9-17", "9-17", "9-17", "-", 4)
        let Alonzo_Lara_Flores = new Docente("Alonzo Lara Flores", "7-17", "7-17", "7-17", "7-17", "7-17", "-", 4)
        let Andres_Dimas_Espino = new Docente("Andres Dimas Espino", "7-17", "7-17", "7-17", "7-17", "7-17", "-", 4)

        let Brayam_Mauricio_Guillermo = new Docente("Brayam Mauricio Guillermo", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        let Selene_Amellali_Torres = new Docente("Selene Amellali Torres", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        let Armando_Martinez_Acevedo = new Docente("Armando Martinez Acevedo", "7-10", "7-10", "11-14", "11-14", "11-14", "-", 1)
        let Juan_Jesus_Marines_Hernandez = new Docente("Juan Jesus Marines Hernandez", "18-21", "-", "18-21", "-", "16-18", "-", 1)
        let Kenia_Mariso_Rivera = new Docente("Kenia Mariso Rivera", "18-21", "-", "18-21", "-", "16-18", "-", 1)
        let Josue_Lucas_Lopez = new Docente("Josue Lucas Lopez", "18-21", "-", "18-21", "-", "16-18", "-", 1)
        

        //Funcion para calcular las horas disponibles de los docentes por dia
        function calcularHorasDisponibles(disponibilidad_cadena) {
            
            if (disponibilidad_cadena === "-" || disponibilidad_cadena.trim() === "") {
                return 0;
            }

            const total_horas = disponibilidad_cadena
            .split(" ")
            .map(rango => {
                const [inicio, fin] = rango.split("-").map(h => parseInt(h))

                if (isNaN(inicio) || isNaN(fin)) {
                    return 0;
                }

                return fin - inicio;
            })
            .reduce((acumulador, duracion) => {
                return acumulador + duracion
            }, 0);

            return total_horas;
        }

        // bucle para calcular la cantidad de horas disponibles por docente
        for (const docente of Docente.lista_docentes) {
            docente.horas_lunes = calcularHorasDisponibles(docente.dispoinibilidad_lunes)
            docente.horas_martes = calcularHorasDisponibles(docente.dispoinibilidad_martes)
            docente.horas_miercoles = calcularHorasDisponibles(docente.dispoinibilidad_miercoles)
            docente.horas_jueves = calcularHorasDisponibles(docente.dispoinibilidad_jueves)
            docente.horas_viernes = calcularHorasDisponibles(docente.dispoinibilidad_viernes)
            docente.horas_sabado = calcularHorasDisponibles(docente.dispoinibilidad_sabado)

            docente.horas_disponibilidad = docente.horas_lunes + docente.horas_martes + docente.horas_miercoles + docente.horas_jueves + docente.horas_viernes + docente.horas_sabado
        }


        //Asignacion docente-materia-grupo
        //LAGE_1ro_NA_A
        LAGE_1ro_NA_A.asignarDocenteAMateria("INGLES I", Brayam_Mauricio_Guillermo)
        LAGE_1ro_NA_A.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_A.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Irma_Elizabeth_Bautista_Valencia)
        LAGE_1ro_NA_A.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Marco_Antonio_Hernandez_Granados)
        LAGE_1ro_NA_A.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("COMUNICACION Y HABILIDADES DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        LAGE_1ro_NA_A.asignarDocenteAMateria("TUTORIA 1RO", Horacio_Sanchez_Hernandez)
       
        //LAGE_1ro_NA_B
        LAGE_1ro_NA_B.asignarDocenteAMateria("INGLES I", Selene_Amellali_Torres)
        LAGE_1ro_NA_B.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_B.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Ariadna_Itzel_Reyes_Aparicio)
        LAGE_1ro_NA_B.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Andres_Dimas_Espino)
        LAGE_1ro_NA_B.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_B.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_B.asignarDocenteAMateria("COMUNICACION Y HABILIDADES DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        LAGE_1ro_NA_B.asignarDocenteAMateria("TUTORIA 1RO", Andres_Dimas_Espino)
        
        //LAGE_1ro_NA_C
        LAGE_1ro_NA_C.asignarDocenteAMateria("INGLES I", Armando_Martinez_Acevedo)
        LAGE_1ro_NA_C.asignarDocenteAMateria("DESARROLLO HUMANO Y VALORES", Karla_Escalante_Alarcon)
        LAGE_1ro_NA_C.asignarDocenteAMateria("FUNDAMENTOS MATEMATICOS", Alonzo_Lara_Flores)
        LAGE_1ro_NA_C.asignarDocenteAMateria("FUNDAMENTOS DE LA ADMINISTRACION", Daniela_Placido_Soriano)
        LAGE_1ro_NA_C.asignarDocenteAMateria("CONTABILIDAD I", Horacio_Sanchez_Hernandez)
        LAGE_1ro_NA_C.asignarDocenteAMateria("MARCO LEGAL DE LAS ORGANIZACIONES", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_1ro_NA_C.asignarDocenteAMateria("COMUNICACION Y HABILIDADES DIGITALES", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        LAGE_1ro_NA_C.asignarDocenteAMateria("TUTORIA 1RO", Alonzo_Lara_Flores)
        
        //LAGE_4to_GCH_A
        LAGE_4to_GCH_A.asignarDocenteAMateria("INGLES IV GCH", Juan_Jesus_Marines_Hernandez)
        LAGE_4to_GCH_A.asignarDocenteAMateria("ETICA PROFESIONAL GCH", Karla_Escalante_Alarcon)
        LAGE_4to_GCH_A.asignarDocenteAMateria("GESTION DEL CAPITAL HUMANO", Daniela_Placido_Soriano)
        LAGE_4to_GCH_A.asignarDocenteAMateria("INTEGRACION DEL CAPITAL HUMANO", Ivan_De_La_Selva_Hernandez)
        LAGE_4to_GCH_A.asignarDocenteAMateria("COMPORTAMIENTO ORGANIZACIONAL", Juan_Carlos_Rodriguez_Olmedo)
        LAGE_4to_GCH_A.asignarDocenteAMateria("SUELDOS Y SALARIOS I", Marco_Antonio_Hernandez_Granados)
        LAGE_4to_GCH_A.asignarDocenteAMateria("LEGISLACION LABORAL", Guillermo_Nicolas_Martinez_Sanchez)
        LAGE_4to_GCH_A.asignarDocenteAMateria("TUTORIA 4TO GCH", Daniela_Placido_Soriano)
        
        //LAGE_4to_EFEP_A
        LAGE_4to_EFEP_A.asignarDocenteAMateria("INGLES IV EFEP", Kenia_Mariso_Rivera)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("ETICA PROFESIONAL EFEP", Karla_Escalante_Alarcon)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("INNOVACION Y EMPRENDIMIENTO", Gabriela_Lazcano_Cortes)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("ESTUDIO DE MERCADO", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("ADMINISTRACIÓN DE PROYECTOS I", Juan_Carlos_Rodriguez_Olmedo)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("FUNDAMENTOS DE SISTEMAS DE PRODUCCION", Cristian_Arturo_Granados_Herrera)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("ESTUDIO TÉCNICO Y ORGANIZACIONAL", Ivan_De_La_Selva_Hernandez)
        LAGE_4to_EFEP_A.asignarDocenteAMateria("TUTORIA 4TO EFEP", Julio_Marquez_Rodriguez)

        //LAGE_4to_EFEP_B
        LAGE_4to_EFEP_B.asignarDocenteAMateria("INGLES IV EFEP", Josue_Lucas_Lopez)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("ETICA PROFESIONAL EFEP", Karla_Escalante_Alarcon)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("INNOVACION Y EMPRENDIMIENTO", Gustavo_Eduardo_Perez_Villegas)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("ESTUDIO DE MERCADO", Mitzi_Ailed_Rosario_Moreno_Ramirez)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("ADMINISTRACIÓN DE PROYECTOS I", Juan_Carlos_Rodriguez_Olmedo)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("FUNDAMENTOS DE SISTEMAS DE PRODUCCION", Cristian_Arturo_Granados_Herrera)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("ESTUDIO TÉCNICO Y ORGANIZACIONAL", Marco_Antonio_Hernandez_Granados)
        LAGE_4to_EFEP_B.asignarDocenteAMateria("TUTORIA 4TO EFEP", Brenda_Garcia_Reyes)

        


        //Funcion para determinar el orden en el que se crearan los horarios de los docentes
        for (const docente of Docente.lista_docentes) {

            if(docente.dispoinibilidad_lunes !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_martes !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_miercoles !== "-"){
                docente.cantidad_dias_disponibles += 1
            }
            if(docente.dispoinibilidad_jueves !== "-"){
                docente.cantidad_dias_disponibles += 1   
            }
            if(docente.dispoinibilidad_viernes !== "-"){
                docente.cantidad_dias_disponibles += 1  
            }
            if(docente.dispoinibilidad_sabado !== "-"){
                docente.cantidad_dias_disponibles += 1  
            }


            // 2. Calcular prioridad evitando división por cero
            if (docente.horas_carga > 0) {
                docente.prioridad = (docente.horas_disponibilidad / docente.horas_carga) * (docente.cantidad_dias_disponibles) * (docente.tipo_docente);
            } else {
                docente.prioridad = 0; // O la lógica que prefieras para docentes sin carga
            }
            
        }
        //reacomodamos la lista de docentes segun su prioridad
        Docente.lista_docentes.sort((a, b) => a.prioridad - b.prioridad);
        Docente.lista_docentes.forEach((docente, index) => {
            console.log(`${index + 1}. Docente: ${docente.nombre_docente} | Prioridad: ${docente.prioridad.toFixed(2)} | Carga: ${docente.horas_carga}`)
        })

        
        //Esta funcion revisa si una hora es disponible para el excel de disponibilidad docente
        function estaDisponible(hora, disponibilidad_cadena) {
            if (!disponibilidad_cadena || disponibilidad_cadena === "-") return false;
    
            // Separamos por espacios por si hay rangos múltiples
            const rangos = disponibilidad_cadena.split(" ");
    
            return rangos.some(rango => {
                const [inicio, fin] = rango.split("-").map(Number);
                // Verificamos si la hora está dentro del rango
                // Usamos >= inicio y < fin (común en horarios)
                return hora >= inicio && hora < fin;
            })
        }

        

        //Apartir de este punto, todo lo de arriba se creo para la funcion que esta debajo
        //Funcion principal, para lo que se hizo todo esto pues----------------------------------------------------------------------------------------------------------------------------------------------
        function crear_horarios_grupos_y_docentes() {
    const diasSemana = ["lunes", "martes", "miercoles", "jueves", "viernes"];

    const obtenerLibresReales = (grupo, docente, dia) => {
        const horarioG = grupo[`horario_${dia}_grupo`]; // Contiene [12, 13... 20]
        const horarioD = docente[`lista_horas_${dia}_docente`];
        // Solo horas que existan en el plan del grupo Y en el docente
        return horarioG.filter(h => typeof h === 'number' && horarioD.includes(h));
    };

    const asignarEspacio = (grupo, docente, dia, horas, materia) => {
        const pG = `horario_${dia}_grupo`;
        const pD = `lista_horas_${dia}_docente`;
        grupo[pG] = grupo[pG].map(h => horas.includes(h) ? `${materia.nombre_materia} - ${docente.nombre_docente}` : h);
        docente[pD] = docente[pD].map(h => horas.includes(h) ? `${materia.nombre_materia} - ${grupo.nombre_grupo}` : h);
    };

    let todasLasMaterias = [];
    Grupo.lista_grupos_LAGE.forEach(g => {
        g.materias.forEach(m => { if (m.docente) todasLasMaterias.push(m); });
    });
    
    todasLasMaterias.sort((a, b) => a.docente.prioridad - b.docente.prioridad);

    const ejecutarAsignacionMateria = (materia) => {
        const docente = materia.docente;
        const grupo = materia.grupo;
        const esVespertino = grupo.turno === "vespertino";
        
        let sesiones = [];
        for (let i = 1; i <= 20; i++) {
            let h = materia.desglose_horas[`horas_clase_${i}`];
            if (h === undefined || h <= 0) continue;
            sesiones.push(h);
        }

        let diasOcupadosEstaMateria = new Set();

        sesiones.forEach((tamanoSesion) => {
            let opcionesPosibles = [];

            diasSemana.forEach(dia => {
                if (docente.tipo_docente !== 1 && diasOcupadosEstaMateria.has(dia)) return;

                const libres = obtenerLibresReales(grupo, docente, dia);
                
                for (let i = 0; i <= libres.length - tamanoSesion; i++) {
                    let bloque = libres.slice(i, i + tamanoSesion);
                    let contiguo = bloque.every((h, idx) => idx === 0 || h === bloque[idx - 1] + 1);
                    if (contiguo) {
                        opcionesPosibles.push({ 
                            dia, 
                            horas: bloque, 
                            horaFin: bloque[bloque.length - 1],
                            horaInicio: bloque[0]
                        });
                    }
                }
            });

            // --- LÓGICA DE TURNOS ---
            if (esVespertino) {
                // Prioriza el final del día (20, 19, 18...)
                opcionesPosibles.sort((a, b) => b.horaFin - a.horaFin);
            } else {
                // Prioriza el inicio del día (7, 8, 9...)
                opcionesPosibles.sort((a, b) => a.horaInicio - b.horaInicio);
            }

            if (opcionesPosibles.length > 0) {
                const mejor = opcionesPosibles[0];
                asignarEspacio(grupo, docente, mejor.dia, mejor.horas, materia);
                diasOcupadosEstaMateria.add(mejor.dia);
            }
        });
    };

    const normalizarTutoria = (n) => n.toUpperCase().includes("TUTORIA");
    todasLasMaterias.forEach(m => { if (!normalizarTutoria(m.nombre_materia)) ejecutarAsignacionMateria(m); });
    todasLasMaterias.forEach(m => { if (normalizarTutoria(m.nombre_materia)) ejecutarAsignacionMateria(m); });
}
        crear_horarios_grupos_y_docentes()
        
        //Funcion de impresion en el excel--------------------------------------------------------------------------------------------------------------------------------------------------------------------
        button_accion.addEventListener("click", descargar_documentos)

        //Funcion de descarga del excel de disponibilidades de docentes
        function generar_excel_disponibilidad_docentes() {
            // 1. Crear un nuevo libro de trabajo (Workbook)
            const workbook = XLSX.utils.book_new();

            // 3. Iterar la lista y crear una hoja por cada docente
            Docente.lista_docentes.forEach(docente => {
                const filasDeHoras = HORAS.map(hora => [hora]);

                const datosHoja = [
                    ["Docente: " + docente.nombre_docente], // Fila 1 (A1)
                    ["Disponbilidad total (horas): " + docente.horas_disponibilidad], // Fila 1 (A2)
                    ["Horas carga (horas): " + docente.horas_carga], // Fila 3 (A3)
                    ["DÍAS:", ...DIAS.map(d => d.toUpperCase())] // Fila 3 (A4) en diferentes columnas
                    
                ]

                HORAS.forEach(hora => {
                    // La primera columna es la hora
                    const fila = [hora]; 

                    // Recorremos cada día para ver si ponemos "X" o vacío
                    DIAS.forEach(dia => {
                        // Accedemos a la propiedad dinámica: docente.dispoinibilidad_lunes, etc.
                        const dispDia = docente[`dispoinibilidad_${dia}`];
                
                        if (estaDisponible(hora, dispDia)) {
                            fila.push("X"); // Marcamos con una X si está disponible
                        } else {
                            fila.push(""); // Vacío si no
                        }
                    })

                    datosHoja.push(fila)
                })
                
                
                // Creamos una hoja de un array de impresion.
                const worksheet = XLSX.utils.aoa_to_sheet(datosHoja)

                // Limpiar nombre (máximo 31 caracteres y quitar caracteres prohibidos)
                const nombreHoja = docente.nombre_docente.substring(0, 31)

                // 4. Añadir la hoja al libro con el nombre del docente
                XLSX.utils.book_append_sheet(workbook, worksheet, nombreHoja)
            })

            // 5. Generar y descargar el archivo
            // Esta función en el navegador dispara la descarga automáticamente
            XLSX.writeFile(workbook, 'Disponibilidad_docentes.xlsx');
        }

        //Funcion de descarga del excel de disponibilidades de los horarios de los grupos
        function generar_excel_horarios_grupos() {
    const workbook = XLSX.utils.book_new();

    const columnasConfig = [
        { etiqueta: "LUNES", propiedad: "horario_lunes_grupo" },
        { etiqueta: "MARTES", propiedad: "horario_martes_grupo" },
        { etiqueta: "MIERCOLES", propiedad: "horario_miercoles_grupo" },
        { etiqueta: "JUEVES", propiedad: "horario_jueves_grupo" },
        { etiqueta: "VIERNES", propiedad: "horario_viernes_grupo" },
        { etiqueta: "SABADO", propiedad: "horario_sabado_grupo" }
    ];

    Grupo.lista_grupos_LAGE.forEach(grupo => {
        const datosHoja = [
            ["Horario del grupo: " + grupo.nombre_grupo],
            [],
            ["HORA", ...columnasConfig.map(c => c.etiqueta)]
        ];

        // Obtenemos el array de horas base que se usó para este turno
        // Esto garantiza que si es vespertino, empiece en 12.
        const horasReferenciaBase = Grupo.CONFIG_HORARIOS[grupo.turno] || [];
        const totalFilas = horasReferenciaBase.length;

        for (let i = 0; i < totalFilas; i++) {
            // La hora real viene de la configuración estática del turno
            const horaReal = horasReferenciaBase[i]; 
            const fila = [horaReal]; // Primera columna: La hora correcta

            columnasConfig.forEach(col => {
                const contenido = grupo[col.propiedad][i];

                // Si es un número, el espacio está vacío (es la hora original)
                // Si es un texto, es la materia asignada
                if (typeof contenido === "number") {
                    fila.push(""); 
                } else {
                    fila.push(contenido); 
                }
            });

            datosHoja.push(fila);
        }

        const worksheet = XLSX.utils.aoa_to_sheet(datosHoja);
        worksheet['!cols'] = [{ wch: 8 }, ...columnasConfig.map(() => ({ wch: 35 }))];
        const nombreLimpio = grupo.nombre_grupo.toString().replace(/[\\\/\?\*\[\]]/g, "").substring(0, 31);
        XLSX.utils.book_append_sheet(workbook, worksheet, nombreLimpio);
    });

    XLSX.writeFile(workbook, 'Horarios_Grupos_LAGE.xlsx');
}

        //Funcion de descarga del excel de los horarios de los docentes
        function generar_excel_horarios_docentes() {
            const workbook = XLSX.utils.book_new();

            const columnasConfig = [
                { etiqueta: "LUNES", propiedad: "lista_horas_lunes_docente" },
                { etiqueta: "MARTES", propiedad: "lista_horas_martes_docente" },
                { etiqueta: "MIERCOLES", propiedad: "lista_horas_miercoles_docente" },
                { etiqueta: "JUEVES", propiedad: "lista_horas_jueves_docente" },
                { etiqueta: "VIERNES", propiedad: "lista_horas_viernes_docente" },
                { etiqueta: "SABADO", propiedad: "lista_horas_sabado_docente" }
            ];

            Docente.lista_docentes.forEach(docente => {
                // CORRECCIÓN: Usar el nombre de la instancia del docente
                const nombreDocenteStr = docente.nombre_docente || "Sin Nombre";
            
                const datosHoja = [
                    ["Horario del docente: " + nombreDocenteStr],
                    [],
                    ["HORA", ...columnasConfig.map(c => c.etiqueta)]
                ];
            
                // Obtenemos el largo del array de este docente específico
                const totalFilas = docente.lista_horas_lunes_docente.length;
            
                for (let i = 0; i < totalFilas; i++) {
                    const horaReferencia = HORAS[i] || ""; 
                    const fila = [horaReferencia];
                
                    columnasConfig.forEach(col => {
                        // CORRECCIÓN: Cambiar 'grupo' por 'docente'
                        const contenido = docente[col.propiedad][i];

                        // Lógica de impresión: si es número (hora vacía) queda en blanco,
                        // si es texto (Materia - Grupo) se imprime.
                        if (typeof contenido === "number") {
                            fila.push(""); 
                        } else {
                            fila.push(contenido); 
                        }
                    });
                
                    datosHoja.push(fila);
                }
            
                const worksheet = XLSX.utils.aoa_to_sheet(datosHoja);
            
                worksheet['!cols'] = [{ wch: 10 }, ...columnasConfig.map(() => ({ wch: 40 }))];
            
                // CORRECCIÓN: Limpiar el nombre usando la variable de la instancia
                const nombreLimpio = nombreDocenteStr.toString()
                    .replace(/[\\\/\?\*\[\]]/g, "")
                    .substring(0, 31);
            
                XLSX.utils.book_append_sheet(workbook, worksheet, nombreLimpio);
            });
        
            XLSX.writeFile(workbook, 'Horarios_Docentes_LAGE.xlsx');
        }

        //Funcion madre de descarga de documentos
        function descargar_documentos(){
            generar_excel_disponibilidad_docentes()
            generar_excel_horarios_grupos()
            generar_excel_horarios_docentes()

        }



    </script>
</body>
</html>